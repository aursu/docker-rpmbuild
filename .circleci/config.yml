version: 2
jobs:
  build6:
    machine:
      image: ubuntu-1604:201903-01
    steps:
      - checkout
      - run:
          name: Build RPM-build Docker images
          command: |
            docker-compose build --pull --no-cache centos6base
            docker-compose build --no-cache centos6build
      - run:
          name: Deploy RPM-build Docker images
          command: |
            docker login -u $DOCKER_USER -p $DOCKER_PASS
            docker push aursu/rpmbuild:6-base
            docker push aursu/rpmbuild:6-build
  build:
    machine:
      image: ubuntu-1604:201903-01
    steps:
      - checkout
      - run:
          name: Build RPM-build Docker images
          command: |
            docker-compose build --pull --no-cache centos7base centos7baseroot
            docker-compose build --no-cache centos7build centos7buildroot centos7repo webrepo
            docker-compose -f docker-compose.systemd.yml build --no-cache centos7basesystemd
            docker-compose -f docker-compose.systemd.yml build --no-cache centos7buildsystemd
            docker-compose -f docker-compose.bintray.yml build --no-cache centos7bintray
            docker-compose -f docker-compose.refresh.yml build --no-cache centos7refresh
            docker-compose -f docker-compose.ftptray.yml build --no-cache centos7ftptray ftprepo
      - run:
          name: Deploy RPM-build Docker images
          command: |
            docker login -u $DOCKER_USER -p $DOCKER_PASS
            docker push aursu/rpmbuild:7-base
            docker push aursu/rpmbuild:7-base-root
            docker push aursu/rpmbuild:7-build
            docker push aursu/rpmbuild:7-build-root
            docker push aursu/rpmbuild:createrepo
            docker push aursu/rpmbuild:webrepo
            docker push aursu/rpmbuild:ftprepo
            docker push aursu/rpmbuild:bintray
            docker push aursu/rpmbuild:refresh
            docker push aursu/rpmbuild:ftptray
      - run:
          name: Deploy RPM-build systemd images
          command: |
            docker push aursu/rpmbuild:7-base-systemd
            docker push aursu/rpmbuild:7-build-systemd
  build8:
    machine:
      image: ubuntu-1604:201903-01
    steps:
      - checkout
      - run:
          name: Build RPM-build Docker images
          command: |
            docker-compose build --pull --no-cache centos8base centos8baseroot
            docker-compose build --no-cache centos8build centos8buildroot
            docker-compose -f docker-compose.systemd.yml build --no-cache centos8basesystemd
            docker-compose -f docker-compose.systemd.yml build --no-cache centos8buildsystemd
      - run:
          name: Deploy RPM-build Docker images
          command: |
            docker login -u $DOCKER_USER -p $DOCKER_PASS
            docker push aursu/rpmbuild:8-base
            docker push aursu/rpmbuild:8-base-root
            docker push aursu/rpmbuild:8-build
            docker push aursu/rpmbuild:8-build-root
      - run:
          name: Deploy RPM-build systemd images
          command: |
            docker push aursu/rpmbuild:8-base-systemd
            docker push aursu/rpmbuild:8-build-systemd
workflows:
  version: 2
  rpmbuild:
    jobs:
      - build6
      - build
      - build8