# Устранение неполадок в REST API (Troubleshooting the REST API)

Узнайте, как диагностировать и решать распространенные проблемы с **REST API**.

---

## Ошибки ограничения частоты запросов (Rate limit errors)

**GitHub** устанавливает ограничения частоты запросов (rate limits), чтобы гарантировать доступность **API** для всех пользователей. Для получения дополнительной информации см. раздел «[Ограничения частоты запросов для **REST API**](https://docs.github.com/en/rest/overview/rate-limits-for-the-rest-api) (Rate limits for the **REST API**)».

Если вы превысите свой основной предел частоты запросов (primary rate limit), вы получите ответ `403 Forbidden` или `429 Too Many Requests`, а заголовок `x-ratelimit-remaining` будет равен `0`. Если вы превысите вторичный предел частоты запросов (secondary rate limit), вы получите ответ `403 Forbidden` или `429 Too Many Requests` и сообщение об ошибке, указывающее на то, что вы превысили вторичный предел частоты запросов.

Если вы получили ошибку ограничения частоты запросов, вам следует временно прекратить выполнение запросов в соответствии со следующими рекомендациями:

  * Если присутствует заголовок ответа `retry-after`, вам не следует повторять запрос до тех пор, пока не пройдет указанное в нем количество секунд.

  * Если заголовок `x-ratelimit-remaining` равен `0`, вам не следует делать новый запрос до времени, указанного в заголовке `x-ratelimit-reset`. Заголовок `x-ratelimit-reset` указан в секундах эпохи UTC (UTC epoch seconds).

  * В противном случае подождите как минимум одну минуту перед повторной попыткой. Если ваш запрос продолжает завершаться ошибкой из-за вторичного предела частоты запросов, увеличивайте время ожидания между попытками экспоненциально (exponentially increasing amount of time) и выдавайте ошибку после определенного количества попыток.

Продолжение выполнения запросов в условиях действия ограничений частоты запросов может привести к блокировке вашей интеграции (integration).

Для получения дополнительной информации о том, как избежать превышения ограничений частоты запросов, см. «[Лучшие практики использования **REST API**](https://docs.github.com/en/rest/guides/best-practices-for-using-the-rest-api) (Best practices for using the **REST API**)».

## `404 Not Found` для существующего ресурса (`404 Not Found` for an existing resource)

Если вы делаете запрос для доступа к приватному ресурсу и ваш запрос не прошел надлежащую **аутентификацию**, вы получите ответ `404 Not Found`. **GitHub** использует ответ `404 Not Found` вместо `403 Forbidden`, чтобы избежать подтверждения существования **приватных репозиториев**.

Если вы получаете ответ `404 Not Found`, когда точно знаете, что запрашиваемый ресурс существует, вам следует проверить вашу **аутентификацию**. Например:

* **Если вы используете личный токен доступа (классический) (personal access token (classic)), убедитесь, что:**
    * Токен имеет **области доступа (scopes)**, необходимые для использования **конечной точки (endpoint)**. Для получения дополнительной информации см. «[Области доступа для приложений OAuth](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/scopes-for-oauth-apps#available-scopes) (Scopes for OAuth apps)» и «[Управление вашими личными токенами доступа](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-fine-grained-personal-access-token) (Managing your personal access tokens)».
    * Владелец токена имеет любые **разрешения (permissions)**, требуемые для использования конечной точки. Например, если конечная точка может использоваться только владельцами организации, то только пользователи, являющиеся владельцами затронутой организации, могут использовать эту конечную точку.
    * Срок действия токена не истек и он не был отозван. Для получения дополнительной информации см. «[Истечение срока действия и отзыв токена](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/token-expiration-and-revocation) (Token expiration and revocation)».

* **Если вы используете личный токен доступа с тонкой настройкой (fine-grained personal access token), убедитесь, что:**
    * Токен имеет **разрешения (permissions)**, необходимые для использования конечной точки. Дополнительные сведения о необходимых разрешениях см. в документации к конкретной конечной точке.
    * Владелец ресурса, указанный для токена, совпадает с владельцем ресурса, на который будет влиять конечная точка.
    * Токен имеет доступ ко всем приватным репозиториям, которые затронет конечная точка.
    * Владелец токена имеет любые разрешения, требуемые для использования конечной точки.
    * Срок действия токена не истек и он не был отозван.

* **Если вы используете токен доступа к установке приложения GitHub (GitHub App installation access token), убедитесь, что:**
    * **Приложение GitHub (GitHub App)** имеет разрешения, необходимые для использования конечной точки.
    * Конечная точка затрагивает только те ресурсы, которыми владеет учетная запись, где установлено **приложение GitHub (GitHub App)**.
    * **Приложение GitHub (GitHub App)** имеет доступ ко всем репозиториям, которые затронет конечная точка.
    * Срок действия токена не истек и он не был отозван.

* **Если вы используете токен доступа пользователя приложения GitHub (GitHub App user access token), убедитесь, что:**
    * **Приложение GitHub (GitHub App)** имеет разрешения, необходимые для использования конечной точки.
    * Пользователь, авторизовавший токен, имеет любые разрешения, требуемые для использования конечной точки.
    * **Приложение GitHub (GitHub App)** и сам пользователь имеют доступ ко всем репозиториям, которые затронет конечная точка.
    * Пользователь одобрил любые обновленные разрешения для вашего **приложения GitHub (GitHub App)**. Для получения дополнительной информации см. раздел **«[Одобрение обновленных разрешений для приложения GitHub](https://docs.github.com/en/apps/using-github-apps/approving-updated-permissions-for-a-github-app) (Approving updated permissions for a GitHub App)»**.

* **Если вы используете токен доступа пользователя приложения OAuth (OAuth app user access token), убедитесь, что:**
    * Токен имеет **области доступа (scopes)**, необходимые для использования конечной точки.
    * Пользователь, авторизовавший токен, имеет любые разрешения, требуемые для использования конечной точки.
    * Организация не заблокировала доступ **приложению OAuth (OAuth app)**, если вы используете конечную точку, которая затронет ресурсы, принадлежащие организации. Для получения дополнительной информации см. раздел **«[Об ограничениях доступа для приложений OAuth](https://docs.github.com/en/organizations/managing-oauth-access-to-your-organizations-data/about-oauth-app-access-restrictions) (About OAuth app access restrictions)»**.
    * Срок действия токена не истек и он не был отозван.

* **Если вы используете `GITHUB_TOKEN` в сценарии автоматизации GitHub Actions (GitHub Actions workflow), убедитесь, что:**
    * Конечная точка затрагивает только те ресурсы, которые принадлежат репозиторию, где запущен сценарий автоматизации. Если вам нужен доступ к ресурсам за пределами этого репозитория (например, к ресурсам организации или другого репозитория), вам следует использовать личный токен доступа или токен доступа для **приложения GitHub (GitHub App)**.

Для получения дополнительной информации об **аутентификации** см. раздел **«[Аутентификация в REST API](https://docs.github.com/en/rest/overview/authenticating-to-the-rest-api) (Authenticating to the REST API)»**.

Вы также должны проверить наличие опечаток в вашем **URL-адресе**. Например, добавление **конечного слэша (trailing slash)** к конечной точке приведет к ошибке `404 Not Found`. Вы можете обратиться к справочной документации по конечной точке, чтобы подтвердить правильность URL.

Кроме того, любые **параметры пути (path parameters)** должны быть **URL-кодированными (URL encoded)**. Например, любые слэши в значении параметра должны быть заменены на `%2F`. Если вы не закодируете слэши в имени параметра должным образом, URL-адрес конечной точки будет неверно истолкован.
